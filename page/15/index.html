<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l4qiang.me","root":"/","scheme":"Gemini","version":"8.0.0-rc.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录点滴，注重积累。">
<meta property="og:type" content="website">
<meta property="og:title" content="CrazyAirhead">
<meta property="og:url" content="http://l4qiang.me/page/15/index.html">
<meta property="og:site_name" content="CrazyAirhead">
<meta property="og:description" content="记录点滴，注重积累。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="L4qiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://l4qiang.me/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CrazyAirhead</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c3ed9d534576a67e94ff8be03a704994";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CrazyAirhead</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">疯狂的傻瓜，傻瓜也疯狂——傻方能执著，疯狂才专注!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/crazy-airhead" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/23/spring/start-error/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/23/spring/start-error/" class="post-title-link" itemprop="url">Spring boot无法启动</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-23 14:37:37 / 修改时间：14:48:59" itemprop="dateCreated datePublished" datetime="2019-04-23T14:37:37+08:00">2019-04-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>286</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天启动Spring boot的一个项目时，提示“Process finished with exit code 1”，项目无法启动。<br>初步分析可能是没有配置环境变了，检查了下是有的，加了debug=true，也没出提示日志。</p>
<p>于是上网查了下，确实说的是环境变量<code>spring.profiles.active</code>没在配置，重新检查配置时发现，之前的环境变量居然是<code>spring.active.profiles</code>。因为换电脑，没有在这台机器运行不同环境，没有发现错误。</p>
<p>提醒下自己，检查配置内容还是要认真些。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.xttblog.com/?p=2992" target="_blank" rel="noopener">解决 Spring boot 启动报 Process finished with exit code 1 问题</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/19/finance/mm-theory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/finance/mm-theory/" class="post-title-link" itemprop="url">MM理论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-19 09:38:53 / 修改时间：10:18:28" itemprop="dateCreated datePublished" datetime="2019-04-19T09:38:53+08:00">2019-04-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%87%91%E8%9E%8D/" itemprop="url" rel="index"><span itemprop="name">金融</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>872</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>MM理论被称为是“公司金融学奠基石的理论”，这个理论是关于融资决策的。香帅把这个理论称为企业融资的地平线理论。</p>
<p>两个M分别是两位作者名字的首个字母，米勒Miller和莫迪利亚尼Modiogian。米勒也因为他在MM理论中的贡献，在1990年和马科维茨、夏普分享了诺贝尔奖。莫迪利亚尼是因为在之前过世了，所以没有拿到诺奖。</p>
<h2 id="推论"><a href="#推论" class="headerlink" title="推论"></a>推论</h2><ul>
<li>一个企业的市场价格决定于它未来能创造的价值。</li>
<li>在有税收存在的情况下，一个企业的价值会随着债务比例的上升而上升。而增加的那部分价值，就恰好等于利息乘以公司的税率。</li>
<li>当债务存在着破产风险的时候，一个企业的价值会随着债务比例的上升而下降，而下降的价值就等于公司总价值乘以破产的概率。</li>
</ul>
<h2 id="为什么是地平线理论"><a href="#为什么是地平线理论" class="headerlink" title="为什么是地平线理论"></a>为什么是地平线理论</h2><p>这个理论看起来挺简单的，为什么这么一个听上去很简单的理论，就拿了诺奖，而且还被誉为“公司金融的奠基性的理论呢”？</p>
<p>一个好理论的评价标准就是能否用一个最简洁（parsimonious）的框架模型解释最多（rich）的现象。</p>
<p>MM定理很明显，完美地做到了这点，它先假设一个没有摩擦的世界，然后一步步地加入这个摩擦，让你可以估算这个摩擦对公司价值的影响。然后从里作为起点，你就可以动态地思考下去，用这个理论作为标尺（benchmark），去度量和评估不同条件下的融资决策。从一个最简洁，最干净的设定，得到最丰富的现实解释。这是理论的力量，也是MM定理做得特别好的地方。</p>
<p>那更牛的地方在哪里呢？就是在MM定理动态演化发展的过程中，学界慢慢形成了一套企业投融资角度的体系化思想。比如说在股东价值最大化的目标下，我们该如何投资项目，该如何选择融资结构，该怎么考虑分红政策，分司的内部治理，哪种选择会更加提升公司的价值。这也是为什么香帅会说MM定理就像公司的地平线理论。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>金融学思维和架构设计的思维有时是相关的，比如KISS，Less Is More。基于一个好理论的评价标准，我们能否用来定义一个好技术架构呢？用一个最简单的框架服务最多的应用场景。</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p>本文为我对《香帅的北大金融学课》的摘抄和整理，更多详细内容请在得到订阅的《香帅的北大金融学课》。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/16/hbase/hbase-indexer/batch-indexing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/16/hbase/hbase-indexer/batch-indexing/" class="post-title-link" itemprop="url">batch-indexing - 批量索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-16 16:00:00 / 修改时间：16:27:22" itemprop="dateCreated datePublished" datetime="2019-04-16T16:00:00+08:00">2019-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/" itemprop="url" rel="index"><span itemprop="name">hbase</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/hbase-indexer/" itemprop="url" rel="index"><span itemprop="name">hbase indexer</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>976</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In addition to indexing HBase updates in near-real-time, it’s also possible to run a batch indexing job that will index data already contained within an HBase table. The batch indexing tool operates with the same indexing semantics as the near-real-time indexer, and it is run as a MapReduce job.</p>
<p>In its most basic running mode, the batch indexing can be run as multiple indexers that run over HBase regions and write data directly to Solr, as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar hbase-indexer-mr-*-job.jar \ </span><br><span class="line">    --hbase-indexer-zk zk01 \</span><br><span class="line">    --hbase-indexer-name docindexer</span><br><span class="line">    --reducers 0</span><br></pre></td></tr></table></figure>
<p>It is also possible to generate offline index shards in HDFS by supplying -1 or a positive integer for the –reducers argument, as shown below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar hbase-indexer-mr-*-job.jar \ </span><br><span class="line">    --hbase-indexer-zk zk01 \</span><br><span class="line">    --hbase-indexer-name docindexer \</span><br><span class="line">    --reducers -1 \</span><br><span class="line">    --output-dir hdfs:&#x2F;&#x2F;namenode&#x2F;solroutput</span><br></pre></td></tr></table></figure>
<p>Finally, indexing shards can be generated offline and then merged into a running SolrCloud cluster using the –go-live flag as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar hbase-indexer-mr-*-job.jar \</span><br><span class="line">    --hbase-indexer-zk zk01 \</span><br><span class="line">    --hbase-indexer-name docindexer \</span><br><span class="line">    --go-live</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/16/hbase/hbase-indexer/metrics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/16/hbase/hbase-indexer/metrics/" class="post-title-link" itemprop="url">metrics - 指标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-16 15:41:00 / 修改时间：16:17:43" itemprop="dateCreated datePublished" datetime="2019-04-16T15:41:00+08:00">2019-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/" itemprop="url" rel="index"><span itemprop="name">hbase</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/hbase-indexer/" itemprop="url" rel="index"><span itemprop="name">hbase indexer</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>The HBase Indexer publishes a number of metrics for each of its indexer processes. These metrics can be useful for getting an idea of how much data is being indexed, keeping track of the health of indexing processes, and troubleshooting problems.</p>
<p>Hbase Indexer发布了一些索引生成时的指标数据。些指标可用于了解索引了多少数据、跟踪索引进程的运行状况和故障排除问题。</p>
<p>By default, all metrics are published via <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html" target="_blank" rel="noopener">JMX</a>. The indexer can also be configured to publish metrics to <a href="http://ganglia.sourceforge.net/" target="_blank" rel="noopener">Ganglia</a> (see below).</p>
<p>默认情况下，所有的指标是通过JMX发布的。也可以通过配置将指标发布到Ganglia中（配置看下文）。</p>
<p>Besides these metrics, you can monitor the replication status using the <a href="https://github.com/NGDATA/hbase-indexer/tree/master/hbase-sep/hbase-sep-tools" target="_blank" rel="noopener">SEP tools</a>.</p>
<p>除了这些指标，还可以通过SEP tools来监控复制集的状态。</p>
<h2 id="可用指标一览（Overview-of-available-metrics）"><a href="#可用指标一览（Overview-of-available-metrics）" class="headerlink" title="可用指标一览（Overview of available metrics）"></a>可用指标一览（Overview of available metrics）</h2><h3 id="HBase-to-Solr-mapping"><a href="#HBase-to-Solr-mapping" class="headerlink" title="HBase to Solr mapping"></a>HBase to Solr mapping</h3><p>Each indexer has a metric under <code>hbaseindexer/DefaultResultToSolrMapper/&lt;indexer_name&gt;/HBase Result to Solr Mapping time</code>.</p>
<p>每个索引在<code>hbaseindexer/DefaultResultToSolrMapper/&lt;indexer_name&gt;/HBase Result to Solr Mapping time</code>下用一个指标。</p>
<p>This metric lists information about the amount of time taken (in milliseconds) for converting an HBase update event into a Solr document, as well as a rate (in documents/second) for the general throughput of the process.</p>
<p>这个指标列出了将Hbase转换成Solr文档的总耗费时间（毫秒），以及文档吐吞率（文档数/秒）。</p>
<h3 id="Incoming-and-applicable-Events"><a href="#Incoming-and-applicable-Events" class="headerlink" title="Incoming and applicable Events"></a>Incoming and applicable Events</h3><p>Under <code>hbaseindexer/(Row|Column)BasedIndexer/&lt;indexer_name&gt;</code>, there are a pair of metrics about incoming events and applicable events. These metrics list the rate of incoming HBase update events, as well as the rate of incoming HBase events that are considered applicable for indexing.</p>
<p>在<code>hbaseindexer/(Row|Column)BasedIndexer/&lt;indexer_name&gt;</code>下， 是一对关于输入事件和可用事件的指标。这些指标列出了输入HBASE更新事件的速率，以及被认为可用索引的输入HBASE事件的速率。</p>
<h3 id="Solr-writing"><a href="#Solr-writing" class="headerlink" title="Solr writing"></a>Solr writing</h3><p>Under <code>hbaseindexer/SolrWriter/&lt;indexer_name&gt;</code>, there are a number of metrics around the rate of adds and delete to Solr.</p>
<p>在<code>hbaseindexer/SolrWriter/&lt;indexer_name&gt;</code>下，是一些关于数据添加和删除到Solr速率的指标。</p>
<p>There are also metrics about “document add/delete errors” and “Solr add/delete errors”. Document-based errors are errors that have occurred where the problem has been determined to be in the Solr document itself. Solr-based errors are errors that have occurred within Solr.</p>
<p>也包含了“文档添加/删除错误”和“Solr添加/删除错误”。基于文档发错误是指发生在Solr文档本身中的错误。基于Solr的错误是在Solr中发生的错误。</p>
<h2 id="Ganglia配置（Ganglia）"><a href="#Ganglia配置（Ganglia）" class="headerlink" title="Ganglia配置（Ganglia）"></a>Ganglia配置（Ganglia）</h2><p>Reporting of metrics to Ganglia can be configured in the <code>hbase-indexer-site.xml</code> file (in the conf directory).</p>
<p>通过配置<code>hbase-indexer-site.xml</code>文件（在conf目录下）可以把指标生成到Ganglia中。</p>
<p>In order to configure reporting in Ganglia, the following three configuration keys must be supplied:</p>
<ul>
<li>hbaseindexer.metrics.ganglia.server - Ganglia server to report to</li>
<li>hbaseindexer.metrics.ganglia.port - port on the Ganglia server</li>
<li>hbaseindexer.metrics.ganglia.interval - interval for reporting, in seconds</li>
</ul>
<p>为了配置Ganglia，下面三个配置需要被指定：</p>
<ul>
<li>hbaseindexer.metrics.ganglia.server - Ganglia服务器地址</li>
<li>hbaseindexer.metrics.ganglia.port - Ganglia服务器端口</li>
<li>hbaseindexer.metrics.ganglia.interval - 生成报告时间间隔</li>
</ul>
<p>An example Ganglia reporting configuration would look like this<br>以下是一个生成Ganglia报告的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbaseindexer.metrics.ganglia.server<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>mygangliaserver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbaseindexer.metrics.ganglia.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>8649<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbaseindexer.metrics.ganglia.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>60<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/16/hbase/hbase-indexer/cli-tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/16/hbase/hbase-indexer/cli-tool/" class="post-title-link" itemprop="url">cli-tool - 命令行工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-16 15:00:00 / 修改时间：16:26:31" itemprop="dateCreated datePublished" datetime="2019-04-16T15:00:00+08:00">2019-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/" itemprop="url" rel="index"><span itemprop="name">hbase</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hbase/hbase-indexer/" itemprop="url" rel="index"><span itemprop="name">hbase indexer</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>The HBase Indexer includes a number of command line tools for adding, updating, listing, and deleting indexers. All of these tools are executed by supplying a command name to the hbase-indexer tool. For example, to use the list-indexers command, you would enter the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;hbase-indexer list-indexers</span><br></pre></td></tr></table></figure>
<p>Running any of the commands below with the –help parameter will show a listing of possible command parameters.</p>
<h2 id="add-indexer"><a href="#add-indexer" class="headerlink" title="add-indexer"></a>add-indexer</h2><p>The “add-indexer” command is used for configuring a new indexer.</p>
<p>When adding an indexer, you need to supply at least the following:</p>
<ul>
<li>the name of the indexer</li>
<li>the indexer’s definition (in the form of an xml file)</li>
<li>connection information to the ZooKeeper used by Solr</li>
</ul>
<p>In order to add a basic indexer named “myindexer” whose definition is saved in a file called myindexer.xml, with ZooKeeper running on a server named myzkhost:2181/solr and a Solr collection named mycollection, you would execute the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;hbase-indexer add-indexer \</span><br><span class="line">                      --name myindexer \</span><br><span class="line">                      --indexer-conf myindexer.xml \</span><br><span class="line">                      --cp solr.zk&#x3D;myzkhost:2181&#x2F;solr \</span><br><span class="line">                      --cp solr.collection&#x3D;mycollection</span><br></pre></td></tr></table></figure>
<h2 id="update-indexer"><a href="#update-indexer" class="headerlink" title="update-indexer"></a>update-indexer</h2><p>The update-indexer command is used for updating the definition or the state of an indexer.</p>
<p>This command is most typically used for updating the definition of an indexer – for example, changing the list of fields to be indexed.</p>
<p>The parameters to the update-indexer tool are generally the same as those for the add-indexer tool, but none of them are mandatory except for the name field.</p>
<p>To update the definition of the indexer that was created in the example for add-indexer, you would run the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;hbase-indexer update-indexer --name myindexer --indexer-conf myupdatedindexer.xml</span><br></pre></td></tr></table></figure>
<p>Any parameters (other than the name parameter) that you supply to the update-indexer command will overwrite existing parameters for the indexer.</p>
<h2 id="list-indexers"><a href="#list-indexers" class="headerlink" title="list-indexers"></a>list-indexers</h2><p>The list-indexer command lists all currently configured indexers, including various status information about them.</p>
<p>This command can be run without any additional parameters.</p>
<h2 id="delete-indexer"><a href="#delete-indexer" class="headerlink" title="delete-indexer"></a>delete-indexer</h2><p>The delete-indexer command removes an indexer and stops all indexing processes for that indexer.</p>
<p>The –name parameter is mandatory for this command.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/04/16/es/sniff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/16/es/sniff/" class="post-title-link" itemprop="url">client.transport.sniff配置引起的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-16 11:38:18 / 修改时间：14:27:30" itemprop="dateCreated datePublished" datetime="2019-04-16T11:38:18+08:00">2019-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>之前基于Docker搭建了ES环境，也能正常使用，这周突然程序能正常启动，但实际发生ES调用时出错，错误如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">org.elasticsearch.client.transport.NoNodeAvailableException: None of the configured nodes are available: [&#123;#transport#-1&#125;&#123;zYhliWDFSRGpbaB371OV-g&#125;&#123;172.26.0.251&#125;&#123;172.26.0.251:9300&#125;]</span><br><span class="line">	at org.elasticsearch.client.transport.TransportClientNodesService.ensureNodesAreAvailable(TransportClientNodesService.java:<span class="number">349</span>)</span><br><span class="line">	at org.elasticsearch.client.transport.TransportClientNodesService.execute(TransportClientNodesService.java:<span class="number">247</span>)</span><br><span class="line">	at org.elasticsearch.client.transport.TransportProxyClient.execute(TransportProxyClient.java:<span class="number">60</span>)</span><br><span class="line">	at org.elasticsearch.client.transport.TransportClient.doExecute(TransportClient.java:<span class="number">381</span>)</span><br><span class="line">	at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:<span class="number">407</span>)</span><br><span class="line">	at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:<span class="number">396</span>)</span><br><span class="line">	at org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:<span class="number">46</span>)</span><br><span class="line">	at org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:<span class="number">53</span>)</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<p>现在将问题做下记录，主要是<code>client.transport.sniff</code>的使用问题。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>基于Docker的ES，<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.1/docker.html#docker-cli-run-prod-mode?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">官网</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type&#x3D;single-node&quot; elasticsearch:6.5.4</span><br></pre></td></tr></table></figure>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>客户端代码基本参照了ES<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html" target="_blank" rel="noopener">官网</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(destroyMethod = <span class="string">"close"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> TransportClient <span class="title">client</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	TransportClient client = <span class="keyword">new</span> PreBuiltTransportClient(settings());</span><br><span class="line"></span><br><span class="line">	String clusterNodes = elasticsearchProperties.getClusterNodes();</span><br><span class="line">	Assert.hasText(clusterNodes, <span class="string">"[Assertion failed] clusterNodes settings missing."</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (String clusterNode : split(clusterNodes, ElasticsearchProperties.COMMA)) &#123;</span><br><span class="line">		String hostName = substringBeforeLast(clusterNode, ElasticsearchProperties.COLON);</span><br><span class="line">		String port = substringAfterLast(clusterNode, ElasticsearchProperties.COLON);</span><br><span class="line">		Assert.hasText(hostName, <span class="string">"[Assertion failed] missing host name in 'clusterNodes'"</span>);</span><br><span class="line">		Assert.hasText(port, <span class="string">"[Assertion failed] missing port in 'clusterNodes'"</span>);</span><br><span class="line">		logger.info(<span class="string">"adding transport node : "</span> + clusterNode);</span><br><span class="line">		client.addTransportAddress(<span class="keyword">new</span> TransportAddress(InetAddress.getByName</span><br><span class="line">				(hostName), Integer.valueOf(port)));</span><br><span class="line">	&#125;</span><br><span class="line">	client.connectedNodes();</span><br><span class="line">	<span class="keyword">return</span> client;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Settings <span class="title">settings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> Settings.builder()</span><br><span class="line">			.put(<span class="string">"cluster.name"</span>, elasticsearchProperties.getClusterName())</span><br><span class="line">			.put(<span class="string">"client.transport.sniff"</span>, elasticsearchProperties.getClientTransportSniff())</span><br><span class="line">			.put(<span class="string">"client.transport.ignore_cluster_name"</span>, elasticsearchProperties</span><br><span class="line">					.getClientIgnoreClusterName())</span><br><span class="line">			.put(<span class="string">"client.transport.ping_timeout"</span>, elasticsearchProperties</span><br><span class="line">					.getClientPingTimeout())</span><br><span class="line">			.put(<span class="string">"client.transport.nodes_sampler_interval"</span>, elasticsearchProperties</span><br><span class="line">					.getClientNodesSamplerInterval())</span><br><span class="line">			.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h2><p>因为之前可以访问，例常的检查了cluster.name和配置的服务器和端口，一切正常。</p>
<p>经过一些搜索后发现这篇文章，<a href="https://discuss.elastic.co/t/transport-client-nonodeavailableexception-none-of-the-configured-nodes-are-available/92000/2" target="_blank" rel="noopener">NoNodeAvailableException</a>，其中提到了配置了<code>client.transport.sniff</code>为<code>true</code>。</p>
<p>检查代码，自己默认配置也是<code>true</code>。调整<code>client.transport.sniff</code>为<code>false</code>，一切正常了。</p>
<h2 id="分析及处理"><a href="#分析及处理" class="headerlink" title="分析及处理"></a>分析及处理</h2><p><code>client.transport.sniff</code>的作用是：使客户端去嗅探整个集群的状态，把集群中其它机器的ip地址加到客户端中。这样做的好处是，一般你不用手动设置集群里所有集群的ip到连接客户端，它会自动帮你添加，并且自动发现新加入集群的机器。</p>
<p>但使用该参数时有个注意事项。当ES服务器监听（publish_address ）使用内网服务器IP，而访问（bound_addresses ）使用外网IP时，不要设置client.transport.sniff为true。不设置client.transport.sniff时，默认为false(关闭客户端去嗅探整个集群的状态)。因为在自动发现时会使用内网IP进行通信，导致无法连接到ES服务器。因此此时需要直接使用addTransportAddress方法把集群中其它机器的ip地址加到客户端中。<br>然后检查了下Docker的启动日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[2019-04-16T05:45:56,427][INFO ][o.e.n.Node               ] [ehrCloud] starting ...</span><br><span class="line">[2019-04-16T05:45:56,648][INFO ][o.e.t.TransportService   ] [ehrCloud] publish_address &#123;172.17.0.3:9300&#125;, bound_addresses &#123;0.0.0.0:9300&#125;</span><br><span class="line">[2019-04-16T05:45:56,796][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [ehrCloud] publish_address &#123;172.17.0.3:9200&#125;, bound_addresses &#123;0.0.0.0:9200&#125;</span><br><span class="line">[2019-04-16T05:45:56,797][INFO ][o.e.n.Node               ] [ehrCloud] started</span><br></pre></td></tr></table></figure>
<p>之后做了如下尝试，修改配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">network.public_host: 172.26.0.251</span><br></pre></td></tr></table></figure>
<p>重新运行程序，此时无论<code>client.transport.sniff</code>的配置为何，都可正常使用。</p>
<p>不过为什么之前可以，现在不行这个问题还是不清楚。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://wenchao.ren/2019/01/org-elasticsearch-client-transport-NoNodeAvailableException-None-of-the-configured-nodes-are-available/" target="_blank" rel="noopener">ES版本问题</a></p>
<p><a href="https://blog.csdn.net/J_bean/article/details/79507559?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">elasticsearch中client.transport.sniff的使用方法和注意事项</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/03/12/spring/springboot-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/12/spring/springboot-2/" class="post-title-link" itemprop="url">SpringBoot与Jfinal合体</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-03-12 14:54:27 / 修改时间：21:13:36" itemprop="dateCreated datePublished" datetime="2019-03-12T14:54:27+08:00">2019-03-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringBoot/Jfinal/" itemprop="url" rel="index"><span itemprop="name">Jfinal</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringBoot/Jfinal/Kotlin/" itemprop="url" rel="index"><span itemprop="name">Kotlin</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>刚接触Jfinal时就对ActiveRecord印象深刻，但公司整体使用SpringBoot框架，使用不多，但一直保持着关注。当Jfinal推出Model生成器，SQL管理和动态生成之后，拿了个项目来练手，找到了淋漓尽致的感觉，惊呼顺畅。如果你使用过Spring Data JPA，只要一对比，你会发现过多的封装就是在挖坑。哦对，就是那个KISS(Keep it Simple and Stupid)原则，异或奥卡姆剃刀原理（如无必要，勿增实体），概念越多，越复杂，越手足无措。回归本质你会得到更多，是的Less Is More。而此时公司项目正在进行一次代码重构，在SpringBoot框架不变的前提下（体系相对完善，有积累），如果能集成Jfinal的ActiveRecord快速搞定增删改查，开发就会变得更简单。是的，我们还在开始使用Kotlin，也是遵循简单，快速原则。</p>
<p>我把整个的集成过程称为SpringBoot和Jfinal的合体，主要分为3部分1.集成ActiveRecord，2.实现代码生成。3.使用方式。</p>
<h2 id="集成ActiveRecord"><a href="#集成ActiveRecord" class="headerlink" title="集成ActiveRecord"></a>集成ActiveRecord</h2><p>参考Jfinal的官方文档<a href="https://www.jfinal.com/doc/5-15" target="_blank" rel="noopener">独立使用ActiveRecord</a>。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveRecordTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    DruidPlugin dp = <span class="keyword">new</span> DruidPlugin(<span class="string">"localhost"</span>, <span class="string">"userName"</span>, <span class="string">"password"</span>);</span><br><span class="line">    ActiveRecordPlugin arp = <span class="keyword">new</span> ActiveRecordPlugin(dp);</span><br><span class="line">    arp.addMapping(<span class="string">"blog"</span>, Blog<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 与 jfinal web 环境唯一的不同是要手动调用一次相关插件的start()方法</span></span><br><span class="line">    dp.start();</span><br><span class="line">    arp.start();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过上面简单的几行代码，即可立即开始使用</span></span><br><span class="line">    <span class="keyword">new</span> Blog().set(<span class="string">"title"</span>, <span class="string">"title"</span>).set(<span class="string">"content"</span>, <span class="string">"cxt text"</span>).save();</span><br><span class="line">    Blog.dao.findById(<span class="number">123</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到，基本上是可以直接使用，在SpringBoot的中，我们只要把ActiveRecordPlugin用一个Bean对象的方式来创建就可以了。<br>于是，有如下代码（当然还有一些配套工作，这里省略了）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">Public ActiveRecordPlugin <span class="title">activeRecordPlugin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidPlugindruidPlugin = druidPlugin();</span><br><span class="line">        druidPlugin.start();</span><br><span class="line">        </span><br><span class="line">        ActiveRecordPluginarp = <span class="keyword">new</span> ActiveRecordPlugin(druidPlugin);</span><br><span class="line">        arp.setTransactionLevel(Connection.TRANSACTION_READ_COMMITTED);</span><br><span class="line">        arp.setShowSql(<span class="keyword">false</span>);</span><br><span class="line">        </span><br><span class="line">        arp.getEngine().setSourceFactory(newClassPathSourceFactory());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> arp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现代码生成"><a href="#实现代码生成" class="headerlink" title="实现代码生成"></a>实现代码生成</h2><p>IDEA可以为JPA后成Entity实体类代码，如果了解Groovy，还可对生成的代码进行一些调整。而Jfinal在框架上就提供了Model的自动生成，对于表更新比较频繁时非常好用。然后查看了下Jfinal的代码生成逻辑，发现了更多的可玩性，于是就不满足于只生成Model了，我们可以通过Jfinal的Enjoy模板引擎，生成基于整个数据库的整个Module（这里指MVC，而非整个工程，工程可通过IDEA的SpringBoot向导来创建），同时为单表提供基本的增删改查（单个查询和分页查询）等基础接口。“有表就有服务”，就是这样简单，之后我们可以更专注于复杂业务逻辑的开发。<br>代码生成逻辑主要分为代码目录结构设计，代码生成逻辑和代码模板修改。</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>SpringBoot的一个原则，是约定大于配置，而微服务架构也强调统一原则，所以必要的目录结构设计或者规范是需要的。</p>
<ol>
<li>所有Model统一放在common/model下。</li>
<li>按业务名优先原则，也就是”业务名/controller”，”业务名/serivce”的方式。</li>
<li>以ModelNameEndpoint，ModelNameService方式来命名。</li>
</ol>
<h3 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h3><p>生成代码的逻辑，主要过程生成Model（同时建构业务分组表信息），生成通用SQL模板，根据不同业务生成Controller和Serivce。我的做法是把Jfinal里面的BaseModelGenerator拷贝出来，做为自己的基类，为不同的模块生成不同的子类，做简单的目录规划和生成模板的调整就可以了，这部分逻辑不复杂。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*生成MVC</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        generateModel();</span><br><span class="line">        genSql();</span><br><span class="line"></span><br><span class="line">        groupTables.forEach((groupName, dbTables) -&gt; &#123;</span><br><span class="line">                genEndpoint(groupName,phrMetaBuilder);</span><br><span class="line">                genService(groupName,phrMetaBuilder);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="业务分组信息"><a href="#业务分组信息" class="headerlink" title="业务分组信息"></a>业务分组信息</h3><p>我这里讲下业务分组信息的提取，继承MetaBuilder重写buildTableNames方法，除了供本生的Model生成，就是提取出来分组表信息，供Controller和Sevice生成器使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function">Protected <span class="keyword">void</span> <span class="title">buildTableNames</span><span class="params">(List&lt;TableMeta&gt; ret)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(groupTables == <span class="keyword">null</span> || groupTables.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">super</span>.buildTableNames(ret);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ResultSet rs = getTablesResultSet();</span><br><span class="line">        Kv kv = Kv.create();</span><br><span class="line">        While (rs.next()) &#123;</span><br><span class="line">                StringtableName=rs.getString(<span class="string">"TABLE_NAME"</span>);</span><br><span class="line">                Stringremarks=rs.getString(<span class="string">"REMARKS"</span>);</span><br><span class="line">                kv.set(tableName,remarks);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        </span><br><span class="line">        groupTables.forEach((group, tables) -&gt; &#123;</span><br><span class="line">                ArrayList&lt;TableMeta&gt; tableMetas = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                String[] tableList = tables.split(<span class="string">","</span>);</span><br><span class="line">                <span class="keyword">for</span> (Stringtable Name : tableList) &#123;</span><br><span class="line">                        TableMetatableMeta = <span class="keyword">new</span> TableMeta();</span><br><span class="line">                        tableMeta.name = tableName;</span><br><span class="line">                        tableMeta.remarks = kv.getStr(tableName);</span><br><span class="line">                        tableMeta.modelName = buildModelName(tableName);</span><br><span class="line">                        tableMeta.baseModelName = buildBaseModelName(tableMeta.modelName);</span><br><span class="line">                        tableMetas.add(tableMeta);</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">                ret.addAll(tableMetas);</span><br><span class="line">                groupTableMeta.put(group,tableMetas);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码模板"><a href="#代码模板" class="headerlink" title="代码模板"></a>代码模板</h3><p>代码模板基本的实现方式就是通过一个工程，书写出来实际可用的代码，之后改成.jf。放到模板路径下。同时根据表信息，调整模板内容。其间不断的生成加修改就好。这里只截取部分代码。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>使用IDEA向导创建SpringBoot工程，注意使用Maven（Gradle的父POM配置方式还没搞定），调整POM文件（如引入父POM，增加依赖等）。</p>
<h3 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h3><p>在生成的Test目录，增加如下代码，运行生成代码。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(<span class="string">SpringRunner:</span>:<span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">SvrPhrApplicationTests</span> &#123;</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> val <span class="string">phrModuleGenerator:</span> PhrModuleGenerator? = null</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun contextLoads() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun genModule() &#123;</span><br><span class="line">        phrModuleGenerator?.setBasePackageName("com.jkzl.phr.phr")</span><br><span class="line">                ?.addGroupTables("adapter",</span><br><span class="line">                        "adapter_data_element," +</span><br><span class="line">                                "adapter_dataset")</span><br><span class="line">                ?.addGroupTables("standard",</span><br><span class="line">                        "std_dataset," +</span><br><span class="line">                                "std_data_element")</span><br><span class="line">                ?.setKotlin(true)</span><br><span class="line">                ?.generate()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="启用ActiveRecord"><a href="#启用ActiveRecord" class="headerlink" title="启用ActiveRecord"></a>启用ActiveRecord</h3><p>通过实现CommanLineRunner接口，在ActiveRecordPlugin Bean对象创建，设置SQL模板，关联Model并启动。代码如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">class SvrPhrApplication : CommandLineRunner &#123;</span><br><span class="line">        Override fun run(vararg <span class="string">args:</span> String?) &#123;</span><br><span class="line">                if(arp != null) &#123;</span><br><span class="line">                        //代码生成后增加</span><br><span class="line">                        arp.addSqlTemplate("/sql/all.sql")</span><br><span class="line">                        _MappingKit.mapping(arp)</span><br><span class="line">                        </span><br><span class="line">                        arp.start()</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                        throw NullPointerException("arpisnull")</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        @Autowired</span><br><span class="line">        Private val arp : ActiveRecordPlugin? = null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>启动项目，我们就可以通过Swagger来查看微服务提供的基础服务了。<br><img src="swagger.png" alt="swagger"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>虽然生成代码模板还在改进之处，多次生成代码覆盖问题没有解决，但重要的是，我们已经起步了，同时通过集成Jfinal的ActiveRecord，吸收Jfinal的Model代码生成，让Springboot开发更简单，而使用Kotlin又简化了一些Java的复杂性。之后你会感叹，居然开发可以如此简单。借Jfinal的口号“为您节约更多时间，去陪恋人、家人和朋友 :)”来结束本文。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1]<a href="https://www.jfinal.com/" target="_blank" rel="noopener">Jfinal官网</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/03/12/spring/springboot-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/12/spring/springboot-1/" class="post-title-link" itemprop="url">SpringBoot-自动配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-12 10:02:21" itemprop="dateCreated datePublished" datetime="2019-03-12T10:02:21+08:00">2019-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-13 23:20:30" itemprop="dateModified" datetime="2019-03-13T23:20:30+08:00">2019-03-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>66</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>Maven设置了打包，没有包含spring.factories</p>
<h2 id="知识盲点"><a href="#知识盲点" class="headerlink" title="知识盲点"></a>知识盲点</h2><ol>
<li>Springboot的自动配置</li>
<li>Maven的Resource</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/03/02/spring/springboot-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/02/spring/springboot-3/" class="post-title-link" itemprop="url">SpringCloud-配置中心</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-02 14:24:45" itemprop="dateCreated datePublished" datetime="2019-03-02T14:24:45+08:00">2019-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-14 11:05:09" itemprop="dateModified" datetime="2019-05-14T11:05:09+08:00">2019-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringCloud/" itemprop="url" rel="index"><span itemprop="name">SpringCloud</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>之前采用Sping Config Server做为配置中心，使用Git做为数据存储和版本控制。整体来说问题不太，可用，便不够商用，或者要做很多拓展。比如更新参数时，需要推送Git，重启服务。如果需要动态更新，需要配置Git服务器的WebHook，设置服务的RefreshScope，同时为了减少WebHook的配置，需要加上Spring Cloud Bus（同时引及RabbitMQ或者Kafka）。另外对不同环境的配置不友好，能过Profile来配置，但配置杂乱，虽然后面通过Git分支加环境变量解决，但管理还是不方便。带着这样的一些问题，碰到了Apollo配置中心，Apollo的很多功能直接就解开了我之前的一些疑惑，那还说什么呢？拿来用就好了。</p>
<h2 id="Apollo配置中心"><a href="#Apollo配置中心" class="headerlink" title="Apollo配置中心"></a>Apollo配置中心</h2><p>Apollo配置中心文档丰富，直接看官方文档就好，看了之后你也会喜欢上他。以下是官网的功能说明：</p>
<ul>
<li>统一管理不同环境、不同集群的配置<ul>
<li>Apollo提供了一个统一界面集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。</li>
<li>同一份代码部署在不同的集群，可以有不同的配置，比如zk的地址等</li>
<li>通过命名空间（namespace）可以很方便的支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖</li>
</ul>
</li>
<li>配置修改实时生效（热发布）<ul>
<li>用户在Apollo修改完配置并发布后，客户端能实时（1秒）接收到最新的配置，并通知到应用程序。</li>
</ul>
</li>
<li>版本发布管理<ul>
<li>所有的配置发布都有版本概念，从而可以方便的支持配置的回滚。</li>
</ul>
</li>
<li>灰度发布<ul>
<li>支持配置的灰度发布，比如点了发布后，只对部分应用实例生效，等观察一段时间没问题后再推给所有应用实例。</li>
</ul>
</li>
<li>权限管理、发布审核、操作审计<ul>
<li>应用和配置的管理都有完善的权限管理机制，对配置的管理还分为了编辑和发布两个环节，从而减少人为的错误。</li>
<li>所有的操作都有审计日志，可以方便的追踪问题。</li>
</ul>
</li>
<li>客户端配置信息监控<ul>
<li>可以方便的看到配置在被哪些实例使用</li>
</ul>
</li>
<li>提供Java和.Net原生客户端<ul>
<li>提供了Java和.Net的原生客户端，方便应用集成</li>
<li>支持Spring Placeholder, Annotation和Spring Boot的ConfigurationProperties，方便应用使用（需要Spring 3.1.1+）</li>
<li>同时提供了Http接口，非Java和.Net应用也可以方便的使用</li>
</ul>
</li>
<li>提供开放平台API<ul>
<li>Apollo自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。</li>
<li>不过Apollo出于通用性考虑，对配置的修改不会做过多限制，只要符合基本的格式就能够保存。</li>
<li>在我们的调研中发现，对于有些使用方，它们的配置可能会有比较复杂的格式，如xml, json，需要对格式做校验。</li>
<li>还有一些使用方如DAL，不仅有特定的格式，而且对输入的值也需要进行校验后方可保存，如检查数据库、用户名和密码是否匹配。</li>
<li>对于这类应用，Apollo支持应用方通过开放接口在Apollo进行配置的修改和发布，并且具备完善的授权和权限控制</li>
</ul>
</li>
<li>部署简单<ul>
<li>配置中心作为基础服务，可用性要求非常高，这就要求Apollo对外部依赖尽可能地少</li>
<li>目前唯一的外部依赖是MySQL，所以部署非常简单，只要安装好Java和MySQL就可以让Apollo跑起来</li>
<li>Apollo还提供了打包脚本，一键就可以生成所有需要的安装包，并且支持自定义运行时参数<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2>通过Apollo配置中心改进了原有Spring Config Server的使用不便。同时如果你的团队使用灰度发布的话，会加深开关驱动开发的了解。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/01/28/misc/three-factors-of-manage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/28/misc/three-factors-of-manage/" class="post-title-link" itemprop="url">管理三要素</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-01-28 09:00:54 / 修改时间：17:55:46" itemprop="dateCreated datePublished" datetime="2019-01-28T09:00:54+08:00">2019-01-28</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>935</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在年会上董事长总结时，说到了管理的铁三角——“人-事-法”，说管理者需要从做事用人到用人做事的思想转变，因人成事，说人和事是一体两面，同时指出法是制度，是机制，是为了降低对人的依赖。这让我想起在雷.达里奥《原则》一书中，有一段对管理原则的描述，我认为他将三者的关系描述得很清楚。</p>
<blockquote>
<p>团队的价值观和原则一旦清晰明了，团队的工作方式（也就是团队文化）将渗透于团队的方方面面，包括如何制定目标、发现问题、诊断问题、设计解决方案、落实方案。人认为团队里关系应该是这样的：</p>
<p><img src="three-factors-of-manage/team.png" alt="团队文化"></p>
<p>清晰传递团队的良好文化非常重要，但这只是“魔法公式”的一半，另一半是<strong>优秀的员工</strong>，他们的价值观、能力、技能都和公司文化相得益彰。<br>每个公司都像一台机器，为了实现目标而运行着，这台机器会产生结果。将目标和结果进行对比，机器的操作者可以了解机器的运行状态，机器的负责人要把这种反馈循环利用好，才能更好地提升机器的性能。基于反馈，这台机器才能调整与提升。这台机器由两块组成——文化与员工。如果结果与目标不符，那机器肯定出问题了，也就是文化和员工出问题了。要让这台机器发展延续下去，就得诊断问题，设计改进方案，落实改进措施。简而言之，这个不断进化的过程如下图所示，花一分钟好好看看，自己思考一下。</p>
<p><img src="three-factors-of-manage/team-culture.png" alt="团队机制"></p>
<p>在这台机器里，这样的过程运行得越多越有效率，进化的速度就越快。</p>
</blockquote>
<p>看了燃点，发现投资人也会更多的关注创业者的品质，认为是创始人是成事的关键。</p>
<p>最近在极客时间看的刘建国的《技术管理实战36讲》中，也讲到管理团队就是带人，做事，建机制。其中有一段关于“关于到底是人靠谱还是机制靠谱”</p>
<blockquote>
<p>很多管理者都认为，事情都是人做的，人如果足够靠谱，机制就没什么用了。对此，我的看法是，人的靠谱度的方差比机制大，即，人靠谱的时候比机制靠谱，人不靠谱的时候会比机制更加不靠谱。即便是最靠谱的员工，也会由于身体状态、精神状态、情绪状态以及外部干扰变得偶尔不靠谱，而机制的意义在于，当人不靠谱的时候，事情也不至于变得很差。所以，机制是为了保证做事的“下限”的。同时，机制很好的迁移性和传承性，不会随着某个人的缺倦而产生大的影响。因此，必要的机制是不可或缺的。</p>
</blockquote>
<p>而书中对如何保障机制了执行也做了提供了最少关键节点检查法，如果你对这方面的内容感兴趣，可以扫码订阅本书。<br><img src="..%5Cgeek-time-ads%5C%E6%8A%80%E6%9C%AF%E7%AE%A1%E7%90%86%E5%AE%9E%E6%88%9836%E8%AE%B2.jpg" alt="技术管理实战36讲"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">L4qiang</p>
  <div class="site-description" itemprop="description">记录点滴，注重积累。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">198</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/enderjo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;enderjo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:L4qiang@gmail.com" title="E-Mail → mailto:L4qiang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">L4qiang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">384k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:49</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
      <div>
        <a href="https://ri.cms.firesbox.com" target="_blank" rel="noopener">践行群官方情报站</a>
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/next-theme/pjax@0/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>
