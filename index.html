<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l4qiang.me","root":"/","scheme":"Gemini","version":"8.0.0-rc.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录点滴，注重积累。">
<meta property="og:type" content="website">
<meta property="og:title" content="CrazyAirhead">
<meta property="og:url" content="http://l4qiang.me/index.html">
<meta property="og:site_name" content="CrazyAirhead">
<meta property="og:description" content="记录点滴，注重积累。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="L4qiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://l4qiang.me/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CrazyAirhead</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c3ed9d534576a67e94ff8be03a704994";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CrazyAirhead</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">疯狂的傻瓜，傻瓜也疯狂——傻方能执著，疯狂才专注!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/enderjo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/05/19/php/env/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/19/php/env/" class="post-title-link" itemprop="url">使用VSCode+Docker搭建PHP远程开发环境搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-19 14:03:51 / 修改时间：23:00:38" itemprop="dateCreated datePublished" datetime="2020-05-19T14:03:51+08:00">2020-05-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VSCode/" itemprop="url" rel="index"><span itemprop="name">VSCode</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VSCode/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VSCode/Docker/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p>搭建VSCode+Docker搭建PHP远程开发环境搭建，主要解决以下几个问题：</p>
<ul>
<li>微信开发调试问题。</li>
<li>随时随地办公问题(具体参看<a href="https://github.com/cdr/code-server" target="_blank" rel="noopener">code-server</a>)。</li>
<li>减少本地环境污染，PHP与Node版本可能冲突(dyld: Library not loaded: /usr/local/opt/icu4c/lib/libicui18n.64.dylib)。</li>
<li>减少硬盘使用。</li>
</ul>
<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><h3 id="本地"><a href="#本地" class="headerlink" title="本地"></a>本地</h3><ul>
<li><p>MacOS</p>
</li>
<li><p>VSCode</p>
</li>
<li><p>Docker Desktop</p>
</li>
</ul>
<h3 id="远程"><a href="#远程" class="headerlink" title="远程"></a>远程</h3><ul>
<li><p>CentOS</p>
</li>
<li><p>Docker CE</p>
</li>
</ul>
<p>本机不使用MacOS，而用Windows，准备好SSH工具应该也没问题。远程服务器，推荐购买<a href="https://www.aliyun.com/acts/hotsale?userCode=l7irb6oi" target="_blank" rel="noopener">阿里云</a>，使用*NIX系统都没有问题。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ul>
<li><p>配置ssh登录远程服务器</p>
</li>
<li><p>安装Docker</p>
</li>
<li><p>安装PHP</p>
</li>
<li><p>安装Nginx</p>
</li>
<li><p>配置VSCode</p>
</li>
<li><p>测试</p>
</li>
</ul>
<p>以上为使用VSCode+Docker搭建PHP远程开发环境搭建的主要过程。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/19/php/env/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/05/12/geektime/chendong/search/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/12/geektime/chendong/search/" class="post-title-link" itemprop="url">记忆与检索技术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-12 23:00:37" itemprop="dateCreated datePublished" datetime="2020-05-12T23:00:37+08:00">2020-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-19 20:25:51" itemprop="dateModified" datetime="2020-05-19T20:25:51+08:00">2020-05-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A3%80%E7%B4%A2%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">检索技术</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>现在的脑科学认为，人脑关于记忆主要分为两种功能：存储功能和提取功能。在《如何学习：成就你的终身学习力》中有一段话是这么写的：</p>
<blockquote>
<p>记忆是不会“丢失”的，不会像我们以为的那样越变越淡，直至踪迹全无。准确地说，“丢失”——其实只是我们一时无法提取出来记忆而已，它的提取能力在当下很低，低到几乎为零。</p>
</blockquote>
<p>作者还举了一个在老式图书馆搜集材料，因为霉味而勾起自己在1982在图书馆工作一段回忆的例子。如果换成触景生情的说法，想来也是有碰到过的。</p>
<p>有些记忆大师公开说过，会在记忆的过程中会将要记忆的内容，配合图像（或故事）一起编码来加速和巩固记忆。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/12/geektime/chendong/search/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/03/07/java/ehcache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/07/java/ehcache/" class="post-title-link" itemprop="url">一次Jfinal使用ehcache的错误记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-07 11:11:38" itemprop="dateCreated datePublished" datetime="2020-03-07T11:11:38+08:00">2020-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-12 22:55:33" itemprop="dateModified" datetime="2020-05-12T22:55:33+08:00">2020-05-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/" itemprop="url" rel="index"><span itemprop="name">jfinal</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/ehcache/" itemprop="url" rel="index"><span itemprop="name">ehcache</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>693</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>Jfinal已经集成了EhCache缓存，只要简单配置就可以使用EhCache。最近的一个字典表数据量比较大，于是开启了EhCache，页面加载速度明显变快。昨日服务突然无法正常启动，错误如下（非法完整错误日志）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.sf.ehcache.CacheException: java.io.InvalidClassException: com.xxx.model.Concept; <span class="built_in">local</span> class incompatible: stream classdesc serialVersionUID = -1234, <span class="built_in">local</span> class serialVersionUID = -5678</span><br></pre></td></tr></table></figure>

<p>看提示我们知道是serialVersionUID版本引起的问题。我们知道ehcache就会进行存盘的，如果保存的对象版本不一致就有可能出现这个问题，此时回忆起对<code>Concept</code>所在的表做了修改和重新生成。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>问题基本清晰了，那解决方法其实是相对简单的，把缓存的文件删除就可以了。</p>
<p>具体做法是这样的，找到<code>ehcache.xml</code>配置文件的的存盘位置，这里我用了<code>java.io.tmpdir</code>，不同操作系统类型此路径可能不一致，可以在程序中打印出来看下， 我这里是<code>/var/folders/d0/..</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(System.getProperty(<span class="string">"java.io.tmpdir"</span>));</span><br></pre></td></tr></table></figure>

<p>删除临时文件，需要根据自己的实际路径进行删除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/folders</span><br><span class="line">rm -rf d0</span><br></pre></td></tr></table></figure>

<p>重新启动服务，正常启动。</p>
<h3 id="更好的方式"><a href="#更好的方式" class="headerlink" title="更好的方式"></a>更好的方式</h3><p>因为系统是可以正常使用的，可以编写个清理的接口，这样可以在数据结构调整时及时清理缓存。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/03/01/java/auth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/01/java/auth/" class="post-title-link" itemprop="url">Jfinal如何为不同的应用提供不同的认证与授权</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-03-01 14:13:25 / 修改时间：23:53:46" itemprop="dateCreated datePublished" datetime="2020-03-01T14:13:25+08:00">2020-03-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/" itemprop="url" rel="index"><span itemprop="name">jfinal</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/Authentication/" itemprop="url" rel="index"><span itemprop="name">Authentication</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/Authentication/Authorization/" itemprop="url" rel="index"><span itemprop="name">Authorization</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>我们需要先了解下认证和授权，因为这两个概念常常被混淆。认证是鉴定用户身份的过程，它通常使用一个标识符 （如用户名或电子邮件地址）和一个加密令牌（比如密码或者存取令牌）来 鉴别用户身份（处理我是谁的问题）。授权是指验证用户是否允许做某件事的过程（处理我能做什么的问题）。更详细描述可以参看<a href="https://insights.thoughtworks.cn/api-2/" target="_blank" rel="noopener">这里</a>。</p>
<p>接下来说说，我们可能碰到的问题，一个产品可能会发布多个前端应用，比如Web，APP，小程序（微信，百度等），管理后台，不同的前端应用可能会有不同需求的。比如微信的授权认证和App的认证就不一致，Web和APP因为能力不同，需要的接口也可能不同，而管理后台可能要基于角色进行授权。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>面对这些问题的时候我们使用Jfinal该如何解决呢？</p>
<p>首先需要参看文档，<a href="https://jfinal.com/doc/2-3" target="_blank" rel="noopener">配置路由</a>，<a href="https://jfinal.com/doc/4-7" target="_blank" rel="noopener">Routes 级别拦截器</a>。</p>
<p>我们可以针对不同的前端应用进行路由拆分和模块化，同时为不同的Routes添加各自的拦截器，实现不同的级别的认证与授权。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebRoutes</span> <span class="keyword">extends</span> <span class="title">Routes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      addInterceptor(<span class="keyword">new</span> JwtInterceptor());</span><br><span class="line">      add(<span class="string">"/api/web/demo"</span>, DemoWebController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppRoutes</span> <span class="keyword">extends</span> <span class="title">Routes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      addInterceptor(<span class="keyword">new</span> JwtInterceptor());</span><br><span class="line">      add(<span class="string">"/api/app/demo"</span>, DemoController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatRoutes</span> <span class="keyword">extends</span> <span class="title">Routes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      addInterceptor(<span class="keyword">new</span> WechatInterceptor());</span><br><span class="line">      addInterceptor(<span class="keyword">new</span> JwtInterceptor());</span><br><span class="line">      add(<span class="string">"/api/wechat/demo"</span>, DemoController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminRoutes</span> <span class="keyword">extends</span> <span class="title">Routes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      addInterceptor(<span class="keyword">new</span> AdminAuthInterceptor());</span><br><span class="line">      add(<span class="string">"/admin/api/demo"</span>, DemoAdminController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">intercept</span><span class="params">(Invocation inv)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Verify Jwt"</span>);</span><br><span class="line">       inv.invoke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">intercept</span><span class="params">(Invocation inv)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Verify Wechat"</span>);</span><br><span class="line">       inv.invoke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminAuthInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">intercept</span><span class="params">(Invocation inv)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Verify Admin"</span>);</span><br><span class="line">       inv.invoke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="comment">//登录接口，清理指定拦截器</span></span><br><span class="line">  <span class="meta">@Clear</span>(&#123;WechatInterceptor<span class="class">.<span class="keyword">class</span>, <span class="title">JwtInterceptor</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">void</span> <span class="title">login</span>() </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> <span class="keyword">extends</span> <span class="title">JFinalConfig</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configRoute</span><span class="params">(Routes me)</span> </span>&#123;</span><br><span class="line">      me.add(<span class="keyword">new</span> WebRoutes());  <span class="comment">// Web路由</span></span><br><span class="line">      me.add(<span class="keyword">new</span> AppRoutes());  <span class="comment">// App路由</span></span><br><span class="line">      me.add(<span class="keyword">new</span> WechatRoutes());  <span class="comment">// App路由</span></span><br><span class="line">      me.add(<span class="keyword">new</span> AdminRoutes());  <span class="comment">// 后端路由</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configConstant</span><span class="params">(Constants me)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configEngine</span><span class="params">(Engine me)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configPlugin</span><span class="params">(Plugins me)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configInterceptor</span><span class="params">(Interceptors me)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configHandler</span><span class="params">(Handlers me)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码并非完整代码，也没有实现实际的拦截器逻辑，只是为了简要的说明问题，如果你在实际的实现过程中碰到问题，可以和我联系，或许能帮上忙。通过配置不同的路由和拦截器，我们还可以尽可能多的复用代码（Controller和Service）。</p>
<h2 id="参看资料"><a href="#参看资料" class="headerlink" title="参看资料"></a>参看资料</h2><p><a href="https://insights.thoughtworks.cn/api-2/" target="_blank" rel="noopener">https://insights.thoughtworks.cn/api-2/</a></p>
<p><a href="https://jfinal.com/doc" target="_blank" rel="noopener">https://jfinal.com/doc</a></p>
<p><a href="https://www.yiiframework.com/doc/guide/2.0/zh-cn" target="_blank" rel="noopener">https://www.yiiframework.com/doc/guide/2.0/zh-cn</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/02/22/java/cors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/22/java/cors/" class="post-title-link" itemprop="url">Jfinal前后端分离项目CORS问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-22 10:11:09" itemprop="dateCreated datePublished" datetime="2020-02-22T10:11:09+08:00">2020-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-07 11:12:57" itemprop="dateModified" datetime="2020-03-07T11:12:57+08:00">2020-03-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/" itemprop="url" rel="index"><span itemprop="name">jfinal</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/vue/cors/" itemprop="url" rel="index"><span itemprop="name">cors</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>对于前后端分离的项目，无论是开发还是部署，可能都会碰到CORS问题。采用Jfinal-undertow方式发布的应用来说，通常是不需要考虑CORS的，因为前端与后端是一起发布的，但在开发时或采用分离部署时，还是会碰到的这个问题，因此在这里按开发和部署两部分讲解如何解决CORS问题。</p>
<p>首先我们简单的了解下什么是CORS，完整的资料可以自己查看<a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener">wikipedia</a>。</p>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>跨域资源共享（<strong>CORS，Cross-origin resource sharing</strong>），它是一种允许<strong>受限的访问第一个访问资源域</strong>以外的资源（如字体）的机制。一张网页通常包含了很多跨域的图片，样式，脚本，iframes，或者视频，但一些跨域请求，尤其是Ajax请求，会因为默认的<a href="https://en.wikipedia.org/wiki/Same-origin_policy" target="_blank" rel="noopener">同源安全策略</a>（简单来说就是绝对路径，需要是协议，域名，端口号三者与第一个访问的资源（浏览器中输入的URL）相同，才被认为是同源）而被禁止访问。</p>
<p>CORS定义了浏览器和服务器如何来决定一个跨域请求是安全的。它比完全同源请求有更多的自由和功能，但不要只是简单地允许所有跨源请求。CORS规范最初是作为W3C推荐标准发布的，但该文档已经过时。 <a href="https://fetch.spec.whatwg.org/" target="_blank" rel="noopener">Fetch Living Standard</a>是当前维护活跃的规范。</p>
<p>对于程序开发来说，可能知道与CORS相关的请求头与响应头，已经够用了。如果需要更细的控制，可以进一步的阅读文档。</p>
<h3 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h3><ul>
<li><p>Origin</p>
</li>
<li><p>Access-Control-Request-Method</p>
</li>
<li><p>Access-Control-Request-Headers</p>
</li>
</ul>
<h3 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h3><ul>
<li><p>Access-Control-Allow-Origin</p>
</li>
<li><p>Access-Control-Allow-Credentials</p>
</li>
<li><p>Access-Control-Expose-Headers</p>
</li>
<li><p>Access-Control-Max-Age</p>
</li>
<li><p>Access-Control-Allow-Methods</p>
</li>
<li><p>Access-Control-Allow-Headers</p>
</li>
</ul>
<p>我们通常使用的是<code>Access-Control-Allow-Origin: *</code>。</p>
<h2 id="开发阶段"><a href="#开发阶段" class="headerlink" title="开发阶段"></a>开发阶段</h2><h3 id="前端处理"><a href="#前端处理" class="headerlink" title="前端处理"></a>前端处理</h3><p>如果后端没有做任何处理的情况，前端通常使用设置Chrome跨域选项和配置vue-cli代理模式这两种方式。推荐使用配置vue-cli代理模式，因为测试人员就可以不需要修改选项了。</p>
<h4 id="修改Chrome跨域选项"><a href="#修改Chrome跨域选项" class="headerlink" title="修改Chrome跨域选项"></a>修改Chrome跨域选项</h4><p>对于Windows用户来说，创建个Chrome的快捷方式，target后中增加<code>--disable-web-security --user-data-dir=</code>即可，如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"...\chrome.exe"</span> --<span class="built_in">disable</span>-web-security --user-data-dir=</span><br></pre></td></tr></table></figure>

<p>对于MacOS用户来说，需要创建好用户数据目录，否则可能无法打开。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open -n &#x2F;Applications&#x2F;Google\ Chrome.app&#x2F; --args --disable-web-security --user-data-dir&#x3D;&#x2F;Users&#x2F;work&#x2F;ChromeDevUserData</span><br></pre></td></tr></table></figure>

<h4 id="vue-cli修改代理模式"><a href="#vue-cli修改代理模式" class="headerlink" title="vue-cli修改代理模式"></a>vue-cli修改代理模式</h4><p>参照vue-cli3的文档中的<a href="https://cli.vuejs.org/zh/config/#devserver-proxy" target="_blank" rel="noopener">devServer.proxy</a>配置即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * vue-cli3跨域的全配置！</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">     proxy:  <span class="string">'http://172.26.0.252:8881'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端处理"><a href="#后端处理" class="headerlink" title="后端处理"></a>后端处理</h3><p>当然我们是希望前端不需要做任何配置，此时后端需要做些开发。实现的方式有很多，这里只展示一种方式简单的实现方式，通过扩展<code>Interceptor</code>实现<code>CorsInterceptor</code>，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">intercept</span><span class="params">(Invocation inv)</span> </span>&#123;</span><br><span class="line">    inv.invoke();</span><br><span class="line">    addCorsHead(inv.getController().getResponse());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCorsHead</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    response.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"POST, GET"</span>);</span><br><span class="line">    response.setHeader(<span class="string">"Access-Control-Max-Age"</span>, <span class="string">"3600"</span>);</span><br><span class="line">    response.setHeader(</span><br><span class="line">        <span class="string">"Access-Control-Allow-Headers"</span>,</span><br><span class="line">        <span class="string">"Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//针对性的提供Cors支持</span></span><br><span class="line"><span class="meta">@Before</span>(CorsInterceptor<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    renderJson(Ret.ok());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> <span class="keyword">extends</span> <span class="title">JFinalConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configInterceptor</span><span class="params">(Interceptors me)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//此处可以加个参数判断，是否加载CorsInterceptor</span></span><br><span class="line">    me.addGlobalActionInterceptor(<span class="keyword">new</span> CorsInterceptor());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="部署阶段"><a href="#部署阶段" class="headerlink" title="部署阶段"></a>部署阶段</h2><h3 id="Jfinal-undertow部署目录结构"><a href="#Jfinal-undertow部署目录结构" class="headerlink" title="Jfinal-undertow部署目录结构"></a>Jfinal-undertow部署目录结构</h3><p>jfinal-undertow推荐采用目录结构部署系统，当然也支持<code>fatjar</code>打包，可以参看<a href="https://jfinal.com/doc/1-3" target="_blank" rel="noopener">jfinal-undertow 下部署</a>。以下是就打包好后的目录格式。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.app</span><br><span class="line">├──config</span><br><span class="line">├──lib</span><br><span class="line">├──webapp</span><br><span class="line">|  └──index.html</span><br><span class="line">└──jfinal.sh</span><br></pre></td></tr></table></figure>

<p>采用这种方式部署是没有跨域问题的。</p>
<h3 id="Nginx部署"><a href="#Nginx部署" class="headerlink" title="Nginx部署"></a>Nginx部署</h3><p>正式环境更多的可能会用Nginx来做反向代理，将不同域名整一起。以下是简单示例，仅供参考：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span> demo.com;</span><br><span class="line">  <span class="attribute">client_max_body_size</span> <span class="number">50m</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://172.17.0.1:80;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://172.17.0.1:81/api;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://l4qiang.me/2018/05/12/frontend/security/cors/">CORS 跨域资源共享</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/02/18/java/frontend/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/18/java/frontend/" class="post-title-link" itemprop="url">Jfinal前后端分离项目指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-18 21:57:46" itemprop="dateCreated datePublished" datetime="2020-02-18T21:57:46+08:00">2020-02-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-19 09:55:27" itemprop="dateModified" datetime="2020-02-19T09:55:27+08:00">2020-02-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/" itemprop="url" rel="index"><span itemprop="name">jfinal</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jfinal/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>本指南只针对使用jfinal开发后端，vue开发前端，使用undertow方式部署的项目。对于非undertow部署项目，可能有所区别，可参考本文自行调整。对使用了Ningx的用户，可以参看Vue文档进行配置。</p>
<p>本文主要针对vue-router采用不同的<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html#后端配置例子" target="_blank" rel="noopener">HTML5 History 模式</a>时的不同处理方法。此处假定你已按undertow方式正常运行后台项目。</p>
<h2 id="hash模式"><a href="#hash模式" class="headerlink" title="hash模式"></a>hash模式</h2><p><code>vue-router</code> 默认 hash 模式 —— 使用 URL 的 hash 来模拟一个完整的 URL，于是当 URL 改变时，页面不会重新加载。</p>
<p>jfinal默认不会对静态页面进行处理（严格一点来说是不会对有“.”路由进行处理）。所以对于hash模式时，你只要把前端页面放置到<code>webapp</code>目录下即可，为了更好管理可以增加个目录，如<code>web</code>。</p>
<p>为了可以直接访问根路径，可以增加一个IndexController，并增加路由。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Clear</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    render(<span class="string">"index.html"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> <span class="keyword">extends</span> <span class="title">JFinalConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configRoute</span><span class="params">(Routes me)</span> </span>&#123;</span><br><span class="line">    me.add("/", IndexController.class, "/web");</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="history模式"><a href="#history模式" class="headerlink" title="history模式"></a>history模式</h2><p>当你使用 history 模式时，URL 就像正常的 url，例如 <code>http://yoursite.com/user/id</code>，也好看！不过这种模式要玩好，还需要后台配置支持。因为我们的应用是个单页客户端应用，如果后台没有正确的配置，当用户在浏览器直接访问 <code>http://oursite.com/user/id</code> 就会返回 404，这就不好看了。</p>
<p>对于Jfinal官网中反馈（详见参考链接），发现更简单的方式还是增加Handler定向转发。此时需要和前端约定好转发路由，如<code>/web</code>。</p>
<h3 id="前端配置"><a href="#前端配置" class="headerlink" title="前端配置"></a>前端配置</h3><p>需要参考<a href="https://cli.vuejs.org/zh/config/#publicpath" target="_blank" rel="noopener">publicPath</a>,将发布目录配置成<code>/web</code>(该值默认为<code>/</code>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  publicPath: <span class="string">"/web"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端修改"><a href="#后端修改" class="headerlink" title="后端修改"></a>后端修改</h3><p>参考<code>FakeStaticHandler</code>(com.jfinal.ext.handler)，实现<code>FakeIndexHandler</code>并增加配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FakeIndexHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> RenderManager renderManager = RenderManager.me();</span><br><span class="line">  <span class="keyword">private</span> String route;</span><br><span class="line">  <span class="keyword">private</span> String viewPath;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FakeIndexHandler</span><span class="params">(String route, String viewPath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.route = route;</span><br><span class="line">    <span class="keyword">this</span>.viewPath = viewPath;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      String target,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span>[] isHandled)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!target.startsWith(route)) &#123;</span><br><span class="line">      next.handle(target, request, response, isHandled);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target.indexOf(<span class="string">'.'</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    isHandled[<span class="number">0</span>] = <span class="keyword">true</span>;</span><br><span class="line">    renderManager.getRenderFactory().getRender(viewPath).setContext(request, response).render();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> <span class="keyword">extends</span> <span class="title">JFinalConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configHandler</span><span class="params">(Handlers me)</span> </span>&#123;</span><br><span class="line">    me.add(<span class="keyword">new</span> FakeIndexHandler(<span class="string">"/web"</span>, <span class="string">"/web/index.html"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Jfinal-undertow可以轻松应对HTML5 History的不同模式，如果是hash模式，可以说是原生支持，如果是History模式，也相对简单。但对于初次使用者来说，可能还是会碰上问题。对于我来说写<code>FackIndexHandler</code>时，就忘记处理静态资源和设置<code>isHandled[0]=true</code>。</p>
<p>希望本文对你有帮助，本文首发<a href="https://l4qiang.me/2020/02/18/java/frontend/">https://l4qiang.me/2020/02/18/java/frontend/</a>。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://www.jfinal.com/feedback/5623" target="_blank" rel="noopener">波总您好，jfinal-undertow下前后端分离项目合并部署访问不到页面</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2020/02/15/misc/keywords/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/15/misc/keywords/" class="post-title-link" itemprop="url">编程语言能打印自己的保留关键字么？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-15 15:33:56 / 修改时间：20:53:44" itemprop="dateCreated datePublished" datetime="2020-02-15T15:33:56+08:00">2020-02-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>今天看到一段Python程序，打印Python的保留关键字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> keyword</span><br><span class="line">print(keyword.kwlist)</span><br></pre></td></tr></table></figure>
<p>程序写了这么多年，也接触了一些语言（C++、Go、Java、Javascript(TypeScript)、Kotlin、Pyton），印象中都是说语言规范，记下来就好。突然就好奇了，有多少语言能利用自己的内置类库完成这个事情呢？于是拿自己接触的这些语言来做个对比。</p>
<h2 id="能否打印关键字"><a href="#能否打印关键字" class="headerlink" title="能否打印关键字"></a>能否打印关键字</h2><p>其实在StackOverflow上也有人有类似的问题，比如：</p>
<ul>
<li><a href="https://stackoverflow.com/questions/9642087/is-it-possible-to-get-a-list-of-keywords-in-python" target="_blank" rel="noopener">Is it possible to get a list of keywords in Python?</a></li>
<li><a href="https://stackoverflow.com/questions/24265110/get-a-list-of-all-java-reserved-keywords" target="_blank" rel="noopener">Get a list of all Java reserved Keywords</a></li>
</ul>
<p>做了个简单的搜索，整理出下面这张表格，表格内容不一定准确，欢迎纠正。</p>
<table>
<thead>
<tr>
<th>Programming Languages</th>
<th>Can print keys by SelfLib</th>
<th>Keywords</th>
</tr>
</thead>
<tbody><tr>
<td>C++</td>
<td>No</td>
<td><a href="https://en.cppreference.com/w/cpp/keyword" target="_blank" rel="noopener">https://en.cppreference.com/w/cpp/keyword</a></td>
</tr>
<tr>
<td>Go</td>
<td>No</td>
<td><a href="https://golang.org/ref/spec#Keywords" target="_blank" rel="noopener">https://golang.org/ref/spec#Keywords</a></td>
</tr>
<tr>
<td>Java</td>
<td>No</td>
<td><a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/_keywords.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/java/nutsandbolts/_keywords.html</a></td>
</tr>
<tr>
<td>JavaScript</td>
<td>No</td>
<td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar</a></td>
</tr>
<tr>
<td>TypeScript</td>
<td>No</td>
<td><a href="https://github.com/Microsoft/TypeScript/issues/2536" target="_blank" rel="noopener">https://github.com/Microsoft/TypeScript/issues/2536</a></td>
</tr>
<tr>
<td>Kotlin</td>
<td>No</td>
<td><a href="https://kotlinlang.org/docs/reference/keyword-reference.html" target="_blank" rel="noopener">https://kotlinlang.org/docs/reference/keyword-reference.html</a></td>
</tr>
<tr>
<td>Python</td>
<td>Yes</td>
<td><a href="https://docs.python.org/3/library/keyword.html" target="_blank" rel="noopener">https://docs.python.org/3/library/keyword.html</a></td>
</tr>
</tbody></table>
<p>一些补充：</p>
<ul>
<li>打印保留关键字本身并不难，维护一个列表就可以的。</li>
<li>Java有个内置函数是可以判断是否为关键字的<code>SourceVersion.isKeyword(str)</code>。</li>
</ul>
<h2 id="语言关键字统计"><a href="#语言关键字统计" class="headerlink" title="语言关键字统计"></a>语言关键字统计</h2><p>在找不同语言关键字的时候找到这样一个统计库。<a href="https://github.com/leighmcculloch/keywords" target="_blank" rel="noopener">A list and count of keywords in programming languages</a></p>
<blockquote>
<p>The number of keywords in a programming language <em>can</em> be an indication to it’s simplicity/complexity, and that can impact the simplicity/complexity of the solutions that developers produce using it. Complex solutions can be more expensive to maintain and difficult to hire for. However, this is dependent on many factors and keyword count is only one; language idioms also play a massive part.</p>
</blockquote>
<h2 id="细节之处见真章"><a href="#细节之处见真章" class="headerlink" title="细节之处见真章"></a>细节之处见真章</h2><p>提供丰富的类库，在意细节，是否会是Python能这么流行的原因呢？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/12/28/misc/RubiksCube/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/28/misc/RubiksCube/" class="post-title-link" itemprop="url">关于学习魔方的一些思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-28 20:51:11" itemprop="dateCreated datePublished" datetime="2019-12-28T20:51:11+08:00">2019-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-19 20:35:57" itemprop="dateModified" datetime="2020-05-19T20:35:57+08:00">2020-05-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AD%94%E6%96%B9/" itemprop="url" rel="index"><span itemprop="name">魔方</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AD%94%E6%96%B9/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">软件开发</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AD%94%E6%96%B9/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">管理</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>事情大致是这样的，在此之前我基本算是零基础，有那么一两次玩是刚好看到同事在玩，顺手玩玩，甚至没完成过一个面。这次呢，因为儿子买了个魔方，玩了会就没玩了，自己就拾起来玩玩，找了视频教程来看，完成整个魔方的复原，现在处于教小孩玩魔方的阶段。在这个学习的过程中呢，有了一些杂七杂八的思考，主要和软件开发有关，于是记录了下来。</p>
<blockquote>
<p>如果你和我一样是魔方初学者，本文可能对你有点用，但这篇不是教程，建议看网上的视频教程。</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/28/misc/RubiksCube/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/12/12/es/olap-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/12/es/olap-2/" class="post-title-link" itemprop="url">Elasticsearch数据建模</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-12 23:46:17" itemprop="dateCreated datePublished" datetime="2019-12-12T23:46:17+08:00">2019-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-13 09:44:18" itemprop="dateModified" datetime="2019-12-13T09:44:18+08:00">2019-12-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>上一篇<a href="https://l4qiang.me/2018/09/28/es/olap-1/">《基于ElasticSearch的OLAP框架思路》</a>简单介绍了ES的存储结构，本文对ES的数据建模做些整理，是对上文的补充。</p>
<h1 id="数据建模"><a href="#数据建模" class="headerlink" title="数据建模"></a>数据建模</h1><h2 id="范式化设计"><a href="#范式化设计" class="headerlink" title="范式化设计"></a>范式化设计</h2><p>在关系型数据库中会强调范式化设计（Normalization），其主要目标是“减少不必要的更新”，但也就带了一个问题“查询缓慢”，因为数据库越范式化，就需要Join越多的表。</p>
<p>关系型数据库设计时，通常设计时做到3NF，但在必要时进行数据的冗余。以下是范式的简要描述：</p>
<ul>
<li>1NF——消除非主属性对键的部分函数依赖</li>
<li>2NF——消除非主属性对键的传递函数依赖</li>
<li>3NF——消除主属性对键的传递函数依赖</li>
<li>BCNF——主属性不依赖主属性</li>
</ul>
<h2 id="反范式化设计"><a href="#反范式化设计" class="headerlink" title="反范式化设计"></a>反范式化设计</h2><p>范式化的另一个好处呢，就是减少了存储空间（也有可能是早些年存储成本大，才有了范式化设计）。但在存储越来越便宜和数据量越来越大，查询需求也越来越多的情况下，关系型数据库就越来越受到挑战，非关系型数据库不断的涌现出来。其实可以理解来范式化设计与反范式化设计的交锋和解决不同的应用场景问题。</p>
<p>反范式化设计（Denormalization），就是尽量不去使用关联关系，而是在文档中保存存冗余的数据，将数据扁平化（Flattening）。这样做的优点很明显，就是数据读取性能好，缺点也很明显，不适合在数据频繁修改的场景，一条数据改动，会引起很多数据的更新，对数据一致性提出更高要求。</p>
<p>ES数据库设计时通常会采用反范式化设计，因为ES并不擅长处理关联关系，一般采用以下四种方法来处理关联：</p>
<ul>
<li>对象类型（Object）</li>
<li>嵌套对象（Nested Object）</li>
<li>父子关系（Parent/Child）</li>
<li>应用端关联</li>
</ul>
<p>其实应用端关联不属于ES设计的部分，在本文中不再赘述，另外基础的数据类型对数据建模影响不大，需要时参看ES相关文档进行设计即可。</p>
<h2 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h2><p>ES采用JSON的文档化存储，而JSON文档天然就是有层级的，文档内可以包含对象（普通对象和数组对象），如果存储数组对象并需要进行查询或统计时，计算结果可能是错误的，这个时候就需要用到嵌套对象。</p>
<h2 id="嵌套对象"><a href="#嵌套对象" class="headerlink" title="嵌套对象"></a>嵌套对象</h2><p>嵌套对象是对象类型的一个特例，允许对象数组中的对象独立索引，Nested文档会被保存在两个Lucene文档中，在查询时做Join处理，因此每次更新，需要重新索引整个对象（包括根对象和嵌套对象）。</p>
<h2 id="父子关系"><a href="#父子关系" class="headerlink" title="父子关系"></a>父子关系</h2><p>ES提供了类似关系型数据库中Join的实现。使用Join数据类型实现，可能过维护Parent/Child的关系，从而分离两个对象。这样呢，父文档和子文档是两个独立的文档，更新父文档时无需重新索引子文档，子文档被添加，更新或者删除时也不会影响父文档和其他的子文档。需要额外的内存维护，读取性能相对差。</p>
<h1 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>对象类型，优先考虑。</li>
<li>嵌套对象，当数据包含多数值对象，同时有查询需求</li>
<li>父子关系，当关联文档更新非常频繁时。</li>
</ul>
<h2 id="避免过多字段"><a href="#避免过多字段" class="headerlink" title="避免过多字段"></a>避免过多字段</h2><ul>
<li>过多字段不容易维护，Mapping保存在Cluster State中，数据量过大时会对集群性能造成影响。删除或修改需要reindex。</li>
<li>默认1000，可通过index.mapping.total_fields.limit来进行设置</li>
<li>Dynamic默认是打开的，只要有新的字段进入Mapping就会更新，导致文档膨胀，可能通过设置Stick，采用Nested Object和Key Value来解决这个问题。</li>
</ul>
<h2 id="避免正则查询"><a href="#避免正则查询" class="headerlink" title="避免正则查询"></a>避免正则查询</h2><ul>
<li>正则，通配符查询，特别是前缀查询，性能不好。可以采用Netest字段方式将一个字段拆分成多个字段。</li>
</ul>
<h2 id="避免空值引起的聚合不准"><a href="#避免空值引起的聚合不准" class="headerlink" title="避免空值引起的聚合不准"></a>避免空值引起的聚合不准</h2><p>null值无论是在关系型数据库，还是在非关系型数据库，都是被特殊对待的。在ES中可以通过设置null_value，来指定字段为null时的默认值。</p>
<h2 id="为索引的Mapping加入Meta信息"><a href="#为索引的Mapping加入Meta信息" class="headerlink" title="为索引的Mapping加入Meta信息"></a>为索引的Mapping加入Meta信息</h2><p>Mappings设置无论从功能，还是性能方面来说都非常的重要，Mappings的每一次变更的都可能造成功能和性能的变化或者数据迁移，因此需要增加Meta（版本）信息并利用版本化控制工具（如Git）进行管理。</p>
<h2 id="重建索引"><a href="#重建索引" class="headerlink" title="重建索引"></a>重建索引</h2><p>可以通过update_by_query来对历史数据的新增字段进行索引的重建。因为ES不允许对已有字段修改数据类型，只能通过reindex的方式将一个索引重新索引到一个新的索引上，但可能通过指定别名的方法来使得减少应用程序的修改。</p>
<h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>对于OLAP来说，数据的清洗和转换是不可避免的，而通过Ingest Node和Painless Script。相当于关系型数据库的存储过程或函数。</p>
<p>Ingest Node：Pipeline&amp;Processor（可实现插件）。</p>
<p>Painless Script：默认缓存100个。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html</a></p>
<p>《Elasticsearch核心技术与实战》</p>
<p><img src="/images/geek-time-ads/Elasticsearch%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98.jpeg" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2019/10/21/nginx/docker-deploy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/21/nginx/docker-deploy/" class="post-title-link" itemprop="url">基于Docker部署Nginx并配置反向代理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-21 10:21:48" itemprop="dateCreated datePublished" datetime="2019-10-21T10:21:48+08:00">2019-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-19 23:00:53" itemprop="dateModified" datetime="2020-05-19T23:00:53+08:00">2020-05-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>我们采用开发直接上线署的方式来快速开发，但因客户已经开始正式使用我司开发的小程序了，为了减少对客户的影响，现在需要额外部署一套开发环境。这个时候首先想到的就是通过Nginx来进行反向代理，开发环境使用二级域名，（如<a href="https://dev.zai500.com），方便开发小程序时候使用。因为中间有一些部署前没有碰过的问题，记录下来，以便后期项目时注意。" target="_blank" rel="noopener">https://dev.zai500.com），方便开发小程序时候使用。因为中间有一些部署前没有碰过的问题，记录下来，以便后期项目时注意。</a></p>
<h2 id="证书转换"><a href="#证书转换" class="headerlink" title="证书转换"></a>证书转换</h2><p>公司项目是从SpringBoot转换到jfinal的，所以之前使用的是JKS格式的证书，需要进行转换，当然如果可以重新申请也能获得不同格式的证书。</p>
<h3 id="jks格式转pkcs12"><a href="#jks格式转pkcs12" class="headerlink" title="jks格式转pkcs12"></a>jks格式转pkcs12</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -srckeystore server.keystore -destkeystore server.p12 -srcalias serverkey -destalias serverkey -srcstoretype jks -deststoretype pkcs12 -srcstorepass 111111 -deststorepass 111111 -noprompt</span><br></pre></td></tr></table></figure>

<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><ul>
<li>importkeystore 指示导入导出keystore文件，可用于同类型或不同类型的导入导出</li>
<li>srckeystore 指示源keystore文件</li>
<li>srcalias 指示源实体别名</li>
<li>srcstoretype 指示源store类型(jks/pkcs12..)</li>
<li>srcstorepass 指示源store密码</li>
<li>noprompt 不弹出提示</li>
</ul>
<h3 id="查看jks信息"><a href="#查看jks信息" class="headerlink" title="查看jks信息"></a>查看jks信息</h3><p>如果不清楚scralias可能通过如下命令来查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -keystore server.jks</span><br></pre></td></tr></table></figure>

<h2 id="创建Nginx容器"><a href="#创建Nginx容器" class="headerlink" title="创建Nginx容器"></a>创建Nginx容器</h2><p>因为我们的应用是使用Docker部署的，我们很自然的，使用Docker来部署Nginx。</p>
<h3 id="拷贝配置"><a href="#拷贝配置" class="headerlink" title="拷贝配置"></a>拷贝配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 -p 443:443 --name nginx -it nginx:stable</span><br><span class="line">docker container cp nginx:/etc/nginx .</span><br></pre></td></tr></table></figure>

<p>以上命令用将nginx的配置信息拷贝到宿主机的当前目录，之后可以将<code>nginx</code>改成<code>conf</code></p>
<h3 id="重新创建容器"><a href="#重新创建容器" class="headerlink" title="重新创建容器"></a>重新创建容器</h3><p>现在映射配置目录，不采用文件映射的方式，因为我们需要配置证书。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop nginx</span><br><span class="line">docker rm nginx</span><br><span class="line">docker run -p 80:80 -p 443:443 --name nginx -v /data/nginx/conf:/etc/nginx -it nginx:stable</span><br></pre></td></tr></table></figure>

<p>注意这里不使用文件的直接映射，因为需要配置证书。</p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><h4 id="将证书文件放置在conf目录下"><a href="#将证书文件放置在conf目录下" class="headerlink" title="将证书文件放置在conf目录下"></a>将证书文件放置在<code>conf</code>目录下</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- zai500.com</span><br><span class="line">--- server.crt</span><br><span class="line">--- server.key</span><br><span class="line">- dev.zai500.com</span><br><span class="line">--- server.crt</span><br><span class="line">--- server.key</span><br></pre></td></tr></table></figure>

<h4 id="修改nginx-conf"><a href="#修改nginx-conf" class="headerlink" title="修改nginx.conf"></a>修改nginx.conf</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> dev.zai500.com;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> dev.zai500.com/server.crt;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> dev.zai500.com/server.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://172.17.0.1:9080;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            <span class="attribute">proxy_hide_header</span> Vary;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Accept-Encoding <span class="string">''</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Referer <span class="variable">$http_referer</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Cookie <span class="variable">$http_cookie</span>;</span><br><span class="line"></span><br><span class="line">            <span class="attribute">proxy_connect_timeout</span> <span class="number">300s</span>;</span><br><span class="line">            <span class="attribute">proxy_send_timeout</span> <span class="number">900</span>;</span><br><span class="line">            <span class="attribute">proxy_read_timeout</span> <span class="number">900</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /im.ws &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://172.17.0.1:9080/im.ws;</span><br><span class="line">            <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Connection <span class="string">"upgrade"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ul>
<li>为减少对外暴露的端口，proxy_pass使用宿主机IP，可能通过<code>ip addr show docker0</code> 来查看，其中<code>inet 172.17.0.1/16</code>部分可获取。</li>
<li>如查有静态资源的访问需要配置好X-Forwarded-Proto和undertow（我自己是修改来程序逻辑），否则会出现Mixed Content的错误。</li>
<li>WebSocket的代理需要额外配置。</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本次Nginx的调整除了方便之后开发外，也加强了自己对Ng配置的理解。中间因为Mixed Content的处理多花费了不少时间。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><img src="/images/geek-time-ads/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Nginx.jpeg" alt=""></p>
<p><a href="https://blog.csdn.net/liuchuan_com/article/details/54376258" target="_blank" rel="noopener">https://blog.csdn.net/liuchuan_com/article/details/54376258</a></p>
<p><a href="https://yq.aliyun.com/articles/617244" target="_blank" rel="noopener">https://yq.aliyun.com/articles/617244</a></p>
<p><a href="https://www.cnblogs.com/mafly/p/websocket.html" target="_blank" rel="noopener">https://www.cnblogs.com/mafly/p/websocket.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">L4qiang</p>
  <div class="site-description" itemprop="description">记录点滴，注重积累。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/enderjo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;enderjo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:L4qiang@gmail.com" title="E-Mail → mailto:L4qiang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">L4qiang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">303k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:36</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/next-theme/pjax@0/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>
